<!doctype html>
<html class="no-js" lang="">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <script src="js/p5.js"></script>
    <script src="js/base.js"></script>
    <script src="js/unoGameShared.js"></script>
    <script src="js/unoGameClient.js"></script>
    <script src="js/unoGameServer.js"></script>
    <script>
        var unoGameClient, unoGameServer;

        // Called before initialization
        function preload() {
            UnoCardsTileset = loadImage("img/unocards.png");
            UnoDeckSprite = loadImage("img/unodeck.png");
            UnoDeckHighlightSprite = loadImage("img/unodeck_highlight.png");
        };

        // Called when the document has been loaded and preload has been completed.
        function setup() {
            // Uno playfield initialization and general p5 setup
            devicePixelScaling(false);
            createCanvas(1024, 768);
            smooth();
            frameRate(30);
            imageMode(CORNER);
            rectMode(CORNER);
            angleMode(RADIANS);
            textAlign(CENTER, CENTER);

            unoGameServer = new UnoGameServer();
            unoGameClient = new UnoGameClient();

            // The first card on the heap
            var heap = unoGameServer.takeCards(6);
            for (var i = 0; i < heap.length; ++i) {
                if (unoGameClient.cards[heap[i]].color === UnoColors.neutral) {
                    unoGameClient.heap.addCard(unoGameClient.cards[heap[i]], UnoColors.red);
                } else {
                    unoGameClient.heap.addCard(unoGameClient.cards[heap[i]]);
                }
            }

            unoGameClient.players = new Array(4);
            unoGameClient.players[0] = new UnoThisPlayer(0, "Jan");
            unoGameClient.players[1] = new UnoOtherPlayer(UnoOtherPlayerLocations.left, 0, "Jef");
            unoGameClient.players[2] = new UnoOtherPlayer(UnoOtherPlayerLocations.top, 0, "Kak");
            unoGameClient.players[3] = new UnoOtherPlayer(UnoOtherPlayerLocations.right, 0, "Kut");

            // Hands of the players
            unoGameClient.players[0].playerTurn = false;
            unoGameClient.players[0].hand = new Array(10);
            var thisPlayerHand = unoGameServer.takeCards(10);
            for (var i = 0; i < 10; ++i) {
                unoGameClient.players[0].hand[i] = unoGameClient.cards[thisPlayerHand[i]];
            }
            unoGameClient.players[0].hand.sort(UnoCardComparison);

            unoGameClient.players[1].hand = 7;
            unoGameClient.players[2].hand = 9;
            unoGameClient.players[3].hand = 10;

        };

        // Called every frame
        function draw() {
            background(255, 204, 0);
            unoGameClient.tick();
            unoGameClient.draw();
        };
    </script>
</body>
</html>